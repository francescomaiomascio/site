# Site Migration: ICE → YAI (In Progress)

**Date:** 2026-02-21  
**Status:** ✅ Build working, ICE legacy cleaned, YAI configured

---

## What's Done

### 1. Content Pipeline Cleanup
- ✅ `projects.config.json` → **YAI canonical only**
  - Replaced: ICE (10 repos) → YAI (5 repos: yai, yai-cli, yai-specs, yai-skin, yai-mind)
  - Old files archived: `label-contract-ice-legacy.md` → `src/content/archive/`
  
- ✅ Removed legacy output files
  - Deleted: `projects.ice.json`, `projects.psc.json`
  - Kept: `projects.index.json` (will regenerate)

- ✅ `compile-project-feeds.mjs` updated
  - Now generates: `projects.yai.json` + `projects.index.json`
  - Removed: ICE output logic

### 2. Pages & Copy Updated
- ✅ `src/app/page.tsx` (hero)
  - Title: "Authority and determinism in runtime systems"
  - Visual: KERNEL, ENGINE, MIND (vs old ICE framing)
  - Updated straplines to YAI-centric

- ✅ `src/app/projects/[id]/page.tsx`
  - Removed hardcoded ICE reference
  - Strapline now: "YAI treats execution as authority: runtime-centric, deterministic, verifiable"

- ✅ `src/content/projects.ts`
  - Single entry: YAI (replaced ICE + PSC)

### 3. yai-skin Integration
- ✅ **Local copy strategy** (temporary, pending npm publication)
  - Added `npm run setup:skin` script
  - Copies CSS + tokens from `../yai-skin` → `src/styles/theme/`
  - `setup:skin` runs before dev and build
  
- ✅ `yai-skin/package.json` updated
  - Added: `"NOTICE", "LICENSE", "README.md"` to `files` array
  - Ready for npm publish

- ✅ Build fixed
  - Removed broken symlink `public/theme`
  - Layout imports from `src/styles/theme/`

- ✅ Build passes
  ```
  ✓ Compiled successfully in 822.9ms
  ✓ Generating static pages (11/11) in 245.3ms
  ```

---

## What Remains (Next Steps)

### 1. Feed Regeneration (Requires GitHub Token)
```bash
cd /home/mothx/COMPUTER_SCIENCE/DEV_CODE/YAI/site
GITHUB_TOKEN=<your_personal_token> node scripts/compile-project-feeds.mjs
```
This generates:
- `src/content/generated/projects.yai.json` (full YAI details)
- `src/content/generated/projects.index.json` (summary for /projects page)

### 2. Verify NOTICE in yai-skin Distribution
When yai-skin is published to npm:
```bash
npm pack @yai-labs/yai-skin
tar -tf package.tgz | grep -E 'NOTICE|LICENSE'
```
Should show NOTICE and LICENSE in tarball.

### 3. Update site/package.json (Future)
Once yai-skin is published:
```json
{
  "dependencies": {
    "@yai-labs/yai-skin": "^0.1.0"
  }
}
```
Remove `setup:skin` script at that time.

### 4. Verify Homepage
```bash
npm run dev
# Visit http://localhost:3000
# Confirm: YAI content, no ICE references
```

---

## File Changes Summary

| File | Change | Status |
|------|--------|--------|
| `scripts/projects.config.json` | ICE → YAI | ✅ |
| `scripts/compile-project-feeds.mjs` | Removed ICE output | ✅ |
| `src/app/page.tsx` | Updated hero copy | ✅ |
| `src/app/projects/[id]/page.tsx` | YAI strapline | ✅ |
| `src/content/projects.ts` | YAI only | ✅ |
| `src/app/layout.tsx` | Import yai-skin CSS | ✅ |
| `package.json` | Added setup:skin script | ✅ |
| `yai-skin/package.json` | Added NOTICE to files | ✅ |
| `public/theme` (symlink) | Removed | ✅ |
| `src/content/archive/label-contract-ice-legacy.md` | Created | ✅ |

---

## Build Status

### Current
```
✅ Build succeeds: npm run build
✅ Dev server starts: npm run dev
✅ No module resolution errors
✅ 11 static pages generated (/projects/[id] uses generateStaticParams)
```

### Known (Expected)
- `/projects/ice` and `/projects/psc` still exist in generated routes
  - **Reason:** Old data in `projects.index.json` (not yet regenerated with new config)
  - **Fix:** Run feed compiler with GITHUB_TOKEN

---

## Architecture

```
site/
├── scripts/
│   ├── compile-project-feeds.mjs  ← Reads projects.config.json
│   └── projects.config.json       ← YAI canonical (only)
├── src/
│   ├── app/
│   │   ├── layout.tsx             ← Imports yai-skin CSS
│   │   ├── page.tsx               ← Hero (YAI copy)
│   │   └── projects/
│   │       ├── page.tsx           ← Reads projects.index.json
│   │       └── [id]/page.tsx      ← Reads projects.yai.json
│   ├── content/
│   │   ├── generated/
│   │   │   └── projects.index.json ← (TODO: regenerate)
│   │   ├── projects.ts             ← YAI only entry
│   │   └── archive/
│   │       └── label-contract-ice-legacy.md
│   └── styles/
│       ├── theme/                  ← yai-skin CSS (copied)
│       └── globals.css
└── public/
    ├── favicon.*
    └── hero/
```

---

## Next: Publishing & Cleanup

Once GITHUB_TOKEN is configured and feed regenerated:
1. Verify projects page shows **only YAI**
2. Verify project detail shows YAI repos + highlights
3. Consider: Archive or delete old ICE references in git history (future cleanup)
4. Update deployment: Ensure GITHUB_TOKEN env var is available in CI/CD

---

**Owner:** Migration Status  
**Last Updated:** 2026-02-21  
